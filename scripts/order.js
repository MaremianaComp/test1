var d=document.querySelector(".order-form");function v(t){let e=t.value.replace(/\D/g,"");if(e.startsWith("7")||e.startsWith("8")){let n="+7 ";e.length>1&&(n+=`(${e.substring(1,4)}`),e.length>4&&(n+=`) ${e.substring(4,7)}`),e.length>7&&(n+=`-${e.substring(7,9)}`),e.length>9&&(n+=`-${e.substring(9,11)}`),t.value=n}else e.length>0?t.value=`+${e}`:t.value=e}function u(t){if(!t)return{isValid:!1,error:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u0435\u043D"};let e=t.replace(/\D/g,"");return e.length===0?{isValid:!1,error:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u0435\u043D"}:/^[78]/.test(e)?e.length!==11?{isValid:!1,error:"\u0420\u043E\u0441\u0441\u0438\u0439\u0441\u043A\u0438\u0439 \u043D\u043E\u043C\u0435\u0440 \u0434\u043E\u043B\u0436\u0435\u043D \u0441\u043E\u0434\u0435\u0440\u0436\u0430\u0442\u044C 11 \u0446\u0438\u0444\u0440"}:{isValid:!0,cleanPhone:e}:e.length<10?{isValid:!1,error:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D \u0441\u043B\u0438\u0448\u043A\u043E\u043C \u043A\u043E\u0440\u043E\u0442\u043A\u0438\u0439"}:e.length>15?{isValid:!1,error:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D \u0441\u043B\u0438\u0448\u043A\u043E\u043C \u0434\u043B\u0438\u043D\u043D\u044B\u0439"}:{isValid:!0,cleanPhone:e}}function h(t,e){l(t);let n=document.createElement("div");n.className="error-message",n.style.color="red",n.style.fontSize="12px",n.style.marginTop="5px",n.textContent=e,t.parentNode.appendChild(n),t.style.borderColor="red"}function l(t){let e=t.parentNode.querySelector(".error-message");e&&e.remove(),t.style.borderColor=""}function f(t){let e=[],n=t.querySelectorAll('input[name="product_id"]'),r=Array.from(t.querySelectorAll('input[name="article"]'));return n.forEach((a,i)=>{let o=a.value,s=r[i]?.value||"",c={id:o,article:s,size:t.querySelector(`input[name="size_${o}"]:checked`)?.value||"",color:t.querySelector(`input[name="color_${o}"]:checked`)?.value||"",quantity:t.querySelector(`input[name="quantity_${o}"]`)?.value||"",price:t.querySelector(`input[name="price_${o}"]`)?.value||"",oldPrice:t.querySelector(`input[name="old_price_${o}"]`)?.value||""};o&&e.push(c)}),e}function y(t){let n=t.querySelector('input[name="phone"]')?.value||"",r=u(n);return{firstName:t.querySelector('input[name="first_name"]')?.value||"",lastName:t.querySelector('input[name="last_name"]')?.value||"",phone:n,phoneClean:r.isValid?r.cleanPhone:"",email:t.querySelector('input[name="email"]')?.value||"",address:t.querySelector('input[name="address"]')?.value||"",comment:t.querySelector('textarea[name="comment"]')?.value||"",promocode:t.querySelector('input[name="promocode"]')?.value||"",paymentMethod:t.querySelector('input[name="payment_method"]:checked')?.value||"",phoneValid:r.isValid}}function g(t){return t.querySelector('input[name="logistic_method"]')?.checked||!1}d.addEventListener("submit",function(t){t.preventDefault();let e=this.querySelector('input[name="phone"]'),n=e?.value||"",r=u(n);if(!r.isValid){h(e,r.error);return}l(e);let a=new FormData(this);console.log("FormData \u0441\u043E\u0434\u0435\u0440\u0436\u0438\u043C\u043E\u0435:");for(let[p,m]of a.entries())console.log(`${p}: ${m}`);let i=f(this),o=y(this),s=g(this),c={...o,products:i,logisticMethod:s};console.log("\u041F\u043E\u043B\u043D\u044B\u0439 \u043E\u0431\u044A\u0435\u043A\u0442 \u0437\u0430\u043A\u0430\u0437\u0430:",JSON.stringify(c,null,2)),console.log("\u0422\u0435\u043B\u0435\u0444\u043E\u043D \u0432\u0430\u043B\u0438\u0434\u0435\u043D:",o.phoneValid),console.log("\u041E\u0447\u0438\u0449\u0435\u043D\u043D\u044B\u0439 \u0442\u0435\u043B\u0435\u0444\u043E\u043D:",o.phoneClean)});document.addEventListener("DOMContentLoaded",()=>{let t=d.querySelector('input[name="phone"]');t&&(t.addEventListener("input",function(){let e=this.selectionStart;v(this),this.setSelectionRange(e,e),l(this)}),t.addEventListener("blur",function(){let e=u(this.value);!e.isValid&&this.value?h(this,e.error):l(this)}),t.addEventListener("focus",function(){this.value||(this.value="+7 ")}))});
